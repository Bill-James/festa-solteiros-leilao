<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Festa dos Solteiros - Leil√£o +18</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, onValue, set, update, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    
    window.firebaseModules = { initializeApp, getDatabase, ref, onValue, set, update, remove };
  </script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { initializeApp, getDatabase, ref, onValue, set, update, remove } = window.firebaseModules;

    // √çcones Lucide (simplificados)
    const Heart = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>;
    const Flame = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>;
    const Users = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
    const Clock = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
    const TrendingUp = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>;
    const Plus = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
    const Play = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
    const Pause = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>;
    const X = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
    const LogOut = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBUbmHryijxLFMfe_YKOKLPfOAKJMIZd0A",
      authDomain: "festa-solteiros-leilao.firebaseapp.com",
      databaseURL: "https://festa-solteiros-leilao-default-rtdb.firebaseio.com",
      projectId: "festa-solteiros-leilao",
      storageBucket: "festa-solteiros-leilao.firebasestorage.app",
      messagingSenderId: "774027959784",
      appId: "1:774027959784:web:f8a244f3b937732ca2985d"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const App = () => {
      const [view, setView] = useState('login');
      const [participantNumber, setParticipantNumber] = useState('');
      const [organizerPassword, setOrganizerPassword] = useState('');
      const [experiences, setExperiences] = useState([]);
      const [selectedExp, setSelectedExp] = useState(null);
      const [bidAmount, setBidAmount] = useState('');
      const [currentTime, setCurrentTime] = useState(Date.now());

      const [newExp, setNewExp] = useState({
        title: '',
        description: '',
        duration: 120,
        startingBid: 500
      });

      // Timer para atualizar o tempo em tempo real
      useEffect(() => {
        const interval = setInterval(() => {
          setCurrentTime(Date.now());
        }, 100);
        return () => clearInterval(interval);
      }, []);

      useEffect(() => {
        const experiencesRef = ref(database, 'experiences');
        const unsubscribe = onValue(experiencesRef, (snapshot) => {
          const data = snapshot.val();
          if (data) {
            const expArray = Object.keys(data).map(key => ({
              id: key,
              ...data[key]
            }));
            setExperiences(expArray);
          } else {
            setExperiences([]);
          }
        });
        return () => unsubscribe();
      }, []);

      useEffect(() => {
        const interval = setInterval(() => {
          const now = Date.now();
          experiences.forEach(exp => {
            if (exp.status === 'active' && exp.endTime <= now) {
              const expRef = ref(database, `experiences/${exp.id}`);
              update(expRef, { status: 'ended' });
            }
          });
        }, 500);
        return () => clearInterval(interval);
      }, [experiences]);

      const handleLogin = (type) => {
        if (type === 'organizer') {
          // Senha do organizador: admin123
          if (organizerPassword === 'admin123') {
            setView('organizer');
            setOrganizerPassword('');
          } else {
            alert('Senha incorreta!');
          }
        } else {
          if (participantNumber.trim()) {
            setView('participant');
          }
        }
      };

      const createExperience = () => {
        if (!newExp.title.trim()) return;
        const expId = Date.now().toString();
        const exp = {
          ...newExp,
          status: 'pending',
          currentBid: newExp.startingBid,
          leadingBidder: null,
          endTime: null,
          createdAt: Date.now()
        };
        const expRef = ref(database, `experiences/${expId}`);
        set(expRef, exp);
        setNewExp({ title: '', description: '', duration: 120, startingBid: 500 });
      };

      const startExperience = (id) => {
        const exp = experiences.find(e => e.id === id);
        const expRef = ref(database, `experiences/${id}`);
        update(expRef, {
          status: 'active',
          endTime: Date.now() + exp.duration * 1000
        });
      };

      const pauseExperience = (id) => {
        const expRef = ref(database, `experiences/${id}`);
        update(expRef, { status: 'paused' });
      };

      const cancelExperience = (id) => {
        const expRef = ref(database, `experiences/${id}`);
        remove(expRef);
      };

      const placeBid = (expId, amount) => {
        const exp = experiences.find(e => e.id === expId);
        if (amount > exp.currentBid && exp.status === 'active') {
          const expRef = ref(database, `experiences/${expId}`);
          update(expRef, {
            currentBid: amount,
            leadingBidder: participantNumber
          });
          setSelectedExp(null);
          setBidAmount('');
        }
      };

      const getTimeRemaining = (exp) => {
        if (exp.status !== 'active') return null;
        const remaining = Math.max(0, exp.endTime - currentTime);
        const mins = Math.floor(remaining / 60000);
        const secs = Math.floor((remaining % 60000) / 1000);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      // LOGIN VIEW
      if (view === 'login') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-pink-500 via-purple-600 to-red-600 flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
              <div className="text-center mb-8">
                <div className="flex justify-center mb-4">
                  <div className="bg-gradient-to-r from-pink-500 to-red-500 p-4 rounded-full">
                    <Heart />
                  </div>
                </div>
                <h1 className="text-4xl font-bold text-gray-800 mb-2">Festa dos Solteiros</h1>
                <p className="text-gray-600">Leil√£o de Experi√™ncias +18</p>
              </div>

              <div className="space-y-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    N√∫mero do Participante
                  </label>
                  <input
                    type="text"
                    value={participantNumber}
                    onChange={(e) => setParticipantNumber(e.target.value)}
                    placeholder="Ex: 42"
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-pink-500 focus:outline-none text-lg"
                  />
                </div>

                <button
                  onClick={() => handleLogin('participant')}
                  className="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white py-4 rounded-xl font-semibold text-lg hover:shadow-lg transition-all flex items-center justify-center gap-2"
                >
                  <Users />
                  Entrar como Participante
                </button>

                <div className="relative">
                  <div className="absolute inset-0 flex items-center">
                    <div className="w-full border-t border-gray-300"></div>
                  </div>
                  <div className="relative flex justify-center text-sm">
                    <span className="px-2 bg-white text-gray-500">ou</span>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Senha do Organizador
                  </label>
                  <input
                    type="password"
                    value={organizerPassword}
                    onChange={(e) => setOrganizerPassword(e.target.value)}
                    placeholder="Digite a senha"
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-gray-800 focus:outline-none text-lg"
                  />
                </div>

                <button
                  onClick={() => handleLogin('organizer')}
                  className="w-full bg-gray-800 text-white py-4 rounded-xl font-semibold text-lg hover:bg-gray-700 transition-all flex items-center justify-center gap-2"
                >
                  <Flame />
                  Painel do Organizador
                </button>
              </div>
            </div>
          </div>
        );
      }

      // PARTICIPANT VIEW
      if (view === 'participant') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-pink-500 via-purple-600 to-red-600 p-4">
            <div className="max-w-4xl mx-auto">
              <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 mb-6 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="bg-white p-2 rounded-full">
                    <Heart />
                  </div>
                  <div>
                    <p className="text-white text-sm">Voc√™ √© o participante</p>
                    <p className="text-white font-bold text-xl">#{participantNumber}</p>
                  </div>
                </div>
                <button
                  onClick={() => setView('login')}
                  className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg flex items-center gap-2"
                >
                  <LogOut />
                  Sair
                </button>
              </div>

              <div className="space-y-4">
                {experiences.length === 0 && (
                  <div className="bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center text-white">
                    <div className="flex justify-center mb-4"><Flame /></div>
                    <p className="text-xl">Nenhuma experi√™ncia dispon√≠vel ainda...</p>
                  </div>
                )}

                {experiences.map(exp => (
                  <div key={exp.id} className="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div className="bg-gradient-to-r from-pink-500 to-red-500 p-4">
                      <h3 className="text-white font-bold text-xl">{exp.title}</h3>
                      <p className="text-white/90 text-sm mt-1">{exp.description}</p>
                    </div>

                    <div className="p-6">
                      <div className="grid grid-cols-2 gap-4 mb-4">
                        <div className="bg-gray-50 rounded-xl p-4">
                          <p className="text-gray-600 text-sm mb-1">Lance Atual</p>
                          <p className="text-2xl font-bold text-gray-800">
                            {exp.currentBid.toLocaleString()} Kz
                          </p>
                        </div>
                        <div className="bg-gray-50 rounded-xl p-4">
                          <p className="text-gray-600 text-sm mb-1">Liderando</p>
                          <p className="text-2xl font-bold text-pink-600">
                            {exp.leadingBidder ? `#${exp.leadingBidder}` : '---'}
                          </p>
                        </div>
                      </div>

                      {exp.status === 'active' && (
                        <div className="bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4 mb-4 flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <Clock />
                            <span className="font-bold text-yellow-800">Tempo Restante:</span>
                          </div>
                          <span className="text-2xl font-mono font-bold text-yellow-800">
                            {getTimeRemaining(exp)}
                          </span>
                        </div>
                      )}

                      {exp.status === 'ended' && (
                        <div className="bg-green-50 border-2 border-green-400 rounded-xl p-4 mb-4 text-center">
                          <p className="font-bold text-green-800 text-lg">üéâ Leil√£o Encerrado!</p>
                          <p className="text-green-700 mt-2">
                            Vencedor: <span className="font-bold">#{exp.leadingBidder || 'Nenhum'}</span>
                          </p>
                        </div>
                      )}

                      {exp.status === 'pending' && (
                        <div className="bg-blue-50 border-2 border-blue-400 rounded-xl p-4 mb-4 text-center">
                          <p className="font-bold text-blue-800">‚è≥ Aguardando in√≠cio...</p>
                        </div>
                      )}

                      {exp.status === 'paused' && (
                        <div className="bg-gray-50 border-2 border-gray-400 rounded-xl p-4 mb-4 text-center">
                          <p className="font-bold text-gray-800">‚è∏Ô∏è Leil√£o Pausado</p>
                        </div>
                      )}

                      {exp.status === 'active' && (
                        <button
                          onClick={() => setSelectedExp(exp)}
                          className="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transition-all flex items-center justify-center gap-2"
                        >
                          <TrendingUp />
                          Fazer Lance
                        </button>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {selectedExp && (
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-2xl p-6 max-w-md w-full">
                  <h3 className="text-2xl font-bold mb-4">{selectedExp.title}</h3>
                  <p className="text-gray-600 mb-4">
                    Lance atual: <span className="font-bold">{selectedExp.currentBid.toLocaleString()} Kz</span>
                  </p>
                  <input
                    type="number"
                    value={bidAmount}
                    onChange={(e) => setBidAmount(e.target.value)}
                    placeholder={`M√≠nimo: ${selectedExp.currentBid + 100} Kz`}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-pink-500 focus:outline-none text-lg mb-4"
                  />
                  <div className="flex gap-3">
                    <button
                      onClick={() => {
                        setSelectedExp(null);
                        setBidAmount('');
                      }}
                      className="flex-1 bg-gray-200 text-gray-800 py-3 rounded-xl font-semibold hover:bg-gray-300"
                    >
                      Cancelar
                    </button>
                    <button
                      onClick={() => placeBid(selectedExp.id, parseInt(bidAmount))}
                      className="flex-1 bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 rounded-xl font-semibold hover:shadow-lg"
                    >
                      Confirmar Lance
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      // ORGANIZER VIEW
      return (
        <div className="min-h-screen bg-gray-100 p-4">
          <div className="max-w-6xl mx-auto">
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="bg-gradient-to-r from-pink-500 to-red-500 p-3 rounded-full">
                    <Flame />
                  </div>
                  <div>
                    <h1 className="text-2xl font-bold text-gray-800">Painel do Organizador</h1>
                    <p className="text-gray-600">Gerencie as experi√™ncias do leil√£o</p>
                  </div>
                </div>
                <button
                  onClick={() => setView('login')}
                  className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg flex items-center gap-2"
                >
                  <LogOut />
                  Sair
                </button>
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-6">
              <div className="bg-white rounded-2xl shadow-lg p-6">
                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                  <Plus />
                  Nova Experi√™ncia
                </h2>
                <div className="space-y-4">
                  <input
                    type="text"
                    value={newExp.title}
                    onChange={(e) => setNewExp({...newExp, title: e.target.value})}
                    placeholder="T√≠tulo (ex: Jantar Rom√¢ntico)"
                    className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:outline-none"
                  />
                  <textarea
                    value={newExp.description}
                    onChange={(e) => setNewExp({...newExp, description: e.target.value})}
                    placeholder="Descri√ß√£o da experi√™ncia..."
                    className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:outline-none h-24"
                  />
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Dura√ß√£o (segundos)
                      </label>
                      <input
                        type="number"
                        value={newExp.duration}
                        onChange={(e) => setNewExp({...newExp, duration: parseInt(e.target.value)})}
                        className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:outline-none"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Lance Inicial (Kz)
                      </label>
                      <input
                        type="number"
                        value={newExp.startingBid}
                        onChange={(e) => setNewExp({...newExp, startingBid: parseInt(e.target.value)})}
                        className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:outline-none"
                      />
                    </div>
                  </div>
                  <button
                    onClick={createExperience}
                    className="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all"
                  >
                    Criar Experi√™ncia
                  </button>
                </div>
              </div>

              <div className="bg-white rounded-2xl shadow-lg p-6">
                <h2 className="text-xl font-bold mb-4">Experi√™ncias Ativas</h2>
                <div className="space-y-3 max-h-96 overflow-y-auto">
                  {experiences.map(exp => (
                    <div key={exp.id} className="border-2 border-gray-200 rounded-lg p-4">
                      <div className="flex items-start justify-between mb-2">
                        <div>
                          <h3 className="font-bold">{exp.title}</h3>
                          <p className="text-sm text-gray-600">{exp.currentBid.toLocaleString()} Kz</p>
                        </div>
                        <span className={`px-2 py-1 rounded text-xs font-semibold ${
                          exp.status === 'active' ? 'bg-green-100 text-green-800' :
                          exp.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                          exp.status === 'ended' ? 'bg-gray-100 text-gray-800' :
                          'bg-blue-100 text-blue-800'
                        }`}>
                          {exp.status === 'active' ? 'Ativo' :
                           exp.status === 'paused' ? 'Pausado' :
                           exp.status === 'ended' ? 'Encerrado' : 'Pendente'}
                        </span>
                      </div>
                      <div className="flex gap-2">
                        {exp.status === 'pending' && (
                          <button
                            onClick={() => startExperience(exp.id)}
                            className="flex-1 bg-green-500 text-white py-2 rounded text-sm font-semibold hover:bg-green-600 flex items-center justify-center gap-1"
                          >
                            <Play />
                            Iniciar
                          </button>
                        )}
                        {exp.status === 'active' && (
                          <button
                            onClick={() => pauseExperience(exp.id)}
                            className="flex-1 bg-yellow-500 text-white py-2 rounded text-sm font-semibold hover:bg-yellow-600 flex items-center justify-center gap-1"
                          >
                            <Pause />
                            Pausar
                          </button>
                        )}
                        {exp.status === 'paused' && (
                          <button
                            onClick={() => startExperience(exp.id)}
                            className="flex-1 bg-green-500 text-white py-2 rounded text-sm font-semibold hover:bg-green-600 flex items-center justify-center gap-1"
                          >
                            <Play />
                            Retomar
                          </button>
                        )}
                        <button
                          onClick={() => cancelExperience(exp.id)}
                          className="bg-red-500 text-white px-3 py-2 rounded text-sm font-semibold hover:bg-red-600"
                          title={exp.status === 'ended' ? 'Apagar' : 'Cancelar'}
                        >
                          <X />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
